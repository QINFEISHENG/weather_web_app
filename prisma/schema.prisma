// prisma/schema.prisma
// DATA STORE SCHEMA
// - WeatherSnapshot: store OBSERVED or FORECAST points
// - EventLog: store simple events for "event collaboration/messaging" style logging

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model WeatherSnapshot {
  id            Int      @id @default(autoincrement())

  // City identity
  city          String
  city_key      String
  country       String?  // e.g., "US"

  // Weather metrics (nullable)
  temp_c        Float?
  feels_like_c  Float?
  humidity      Int?

  // Weather description (nullable)
  weather_main  String?
  weather_desc  String?

  // Timestamp from OpenWeather:
  // - OBSERVED: current weather dt
  // - FORECAST: forecast point dt (3-hr step)
  observed_unix Int?

  // Distinguish row meaning
  // "OBSERVED" or "FORECAST"
  data_type     String   @default("OBSERVED")

  // When we stored in DB (server time)
  createdAt     DateTime @default(now())

  // Indexes for analytics
  @@index([city_key, data_type, createdAt])
  @@index([city_key, data_type, observed_unix])
  @@index([createdAt])

  // Avoid duplicates for same city/type/timestamp
  @@unique([city_key, data_type, observed_unix])
}

model EventLog {
  id        Int      @id @default(autoincrement())
  eventType String
  payload   Json
  createdAt DateTime @default(now())
}